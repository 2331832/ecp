package net.loyin.model.sys;

import java.util.Date;

import net.loyin.jfinal.anatation.TableBind;
import net.loyin.kit.I18N;

import com.jfinal.plugin.activerecord.Model;
/**
 * 酒帮管理
 * @author xd
 */
@TableBind(name="sp_jiubang",pk="ID")
public class Jiubang extends Model<Jiubang> {
	private static final long serialVersionUID = -7996568801390220823L;
	public static String tableName="sp_jiubang";
	public static final Jiubang dao=new Jiubang();
	/**
	 * 创建酒帮
	 * @param openid
	 * @return 消息
	 */
	public String create(String openid){
		WxUser u=WxUser.dao.findByOpenId(openid);
		if(u!=null){
			if(u.getInt("jbm")==1){//如果是酒帮成员
				if(u.getInt("shopcount")>=1){//已经购买酒
					Jiubang jb=new Jiubang();
					jb.set("wxuid",u.getLong("id"));
					jb.set("ctime",new Date());
					jb.set("jbno","jb_"+u.getLong("id"));
					if(jb.save()){
						//创建酒帮成功！请回复信息“XGJBMC+酒帮名称”来修改酒帮名称
						return I18N.getText("jiubang_0");
					}else{
						//创建酒帮失败！
						return I18N.getText("jiubang_1");
					}
				}else{
					//"您还未购买商品，请在购买成功后再创建酒帮！";
					return I18N.getText("jiubang_2");
				}
			}else{
					//"您不是酒帮成员，请先加入一个酒帮！";
				return I18N.getText("jiubang_3");
			}
			
		}
		return null;
	}
	/***
	 * 加入酒帮
	 * @param openId
	 * @param cjid 场景ID
	 * @return 返回消息
	 */
	public String join(String openId,Long cjid ){
		return null;
	}
}
